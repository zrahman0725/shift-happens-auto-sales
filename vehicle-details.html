<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Details - Shift Happens Auto Sales</title>

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel="stylesheet">

    <link rel="stylesheet" href="css/vehicle-details.css">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?">

</head>

<body>
    <!-- Back to Inventory Link -->
    <div class="back-link">
        <a href="inventory.html">&lt; Back to Inventory</a>
    </div>

    <header class="header">
        <a href="index.html" class="logo"><img src="images/IMG-20241122-WA0003_1468205583269761 (1).png" alt="">Shift Happens Auto Sales</a>

        <i class='bx bx-menu' id="menu-icon"></i>

        <nav class="navbar">
            <a href="index.html#home" data-alt-link="home.html">Home</a>
            <div class="dropdown">
                <a href="inventory.html" data-alt-link="inventory.html" class="active">Inventory</a>

            </div>
            <div class="dropdown">
                <a href="finance.html" data-alt-link="finance.html">Finance</a>
                <div class="dropdown-menu">
                    <a href="finance-application.html">Finance Application</a>
                    <a href="finance.html">Finance Department</a>
                    <a href="finance.html#credit">Credit Tips</a>
                </div>
            </div>
            <div class="dropdown">
                <a href="services.html" data-alt-link="services.html">Services</a>
                <div class="dropdown-menu">
                    <a href="detailing.html">Detailing</a>
                    <a href="trade-in.html">Trade-ins</a>
                    <a href="test-drive.html">Test Drives</a>
                    <a href="car-loan.html">Loan Calculator</a>
                </div>
            </div>
            <div class="dropdown">
                <a href="about.html" data-alt-link="about.html">Dealership</a>
                <div class="dropdown-menu">
                    <a href="about.html">About Us</a>
                    <a href="index.html#contact-form">Contact</a>
                </div>
            </div>
        </nav>
        
        
    </header>

    <!-- Main Content -->
    <section class="vehicle-details-section">
        <div class="details-container">
            <!-- Left Section: Image Carousel -->
            <div class="details-left">
                <div class="carousel">
                    <div class="main-image">
                        <button class="carousel-button prev">&lt;</button>
                        <div class="main-image-container">
                            <img id="main-carousel-image" src="" alt="Vehicle Image">
                            <div class="hover-overlay">View Fullscreen</div>
                        </div>
                        <button class="carousel-button next">&gt;</button>
                    </div>
                    <div class="thumbnail-strip">
                        <!-- Thumbnails will be populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Right Section: Vehicle Information -->
            <div class="details-right">
                <h2>
                    <span id="vehicle-title"></span>
                    <span id="vehicle-trim" style="font-weight: normal; font-size: 18px; margin-left: 8px; color: #666;"></span>
                  </h2>                  
                <h3 id="vehicle-price"></h3>
                <span class="vehicle-info">
                    <span style="color: #888888;" id="vehicle-vin">VIN: N/A</span> | 
                    <span style="color: #888888;" id="vehicle-stock">Stock #: N/A</span>
                </span>
                <hr class="separator">
                <ul class="key-details-grid" id="vehicle-details-list">
                    <!-- Key details will be populated dynamically -->
                </ul>
                <hr class="separator">
                <div class="description">
                    <h4>Vehicle Description</h4>
                    <p id="vehicle-description"></p>
                </div>
                <hr class="separator">
                <div class="features">
                    <h4>Features & Specs</h4>
                    <div class="accordion">
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Mechanical</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="mechanical-specs"></div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Safety</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="safety-specs"></div>
                        </div>
                        <!-- Repeat for other categories -->
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Exterior</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="exterior-specs"></div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Interior</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="interior-specs"></div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Entertainment</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="entertainment-specs"></div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <h6>Additional Features</h6>
                                <h6 class="accordion-icon">▼</h6>
                            </div>
                            <div class="accordion-body" id="additional-specs"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sticky Sidebar -->
        <div class="vdp-sidebar">
            <div class="price-section">
                <h3 id="sidebar-price"></h3>
                <p>+ taxes and fees</p>
            </div>
            <div class="cta-buttons">
                <button class="cta-button" onclick="redirectToFinance()">Apply Now</button>
                <button class="cta-button" onclick="redirectToContact()">Request Info</button>
                <button class="cta-button" onclick="redirectToTestDrive()">Test Drive</button>
                <a class="cta-button" href="tel:+18257364438">Call Us</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-text">
            <p>Copyright &copy; 2024 by Shift Happens Auto Sales | All Rights Reserved. | <a href="admin-login.html">Admin</a></p>
        </div>
        <div class="footer-iconTop">
            <a href="#"><i class='bx bx-up-arrow-alt'></i></a>
        </div>
    </footer>


    <!-- JavaScript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        
        const firebaseConfig = {
            apiKey: "AIzaSyDv6Jkk-7XqeCMTy14Fjs_upMAjVM7uNVg",
            authDomain: "shift-happens-auto-sales.firebaseapp.com",
            projectId: "shift-happens-auto-sales",
            storageBucket: "shift-happens-auto-sales.appspot.com",
            messagingSenderId: "224158026936",
            appId: "1:224158026936:web:690dd13405f6b1bfc4b84d"
        };

        document.querySelector(".main-image-container").addEventListener("click", () => {
            const vehicleId = new URLSearchParams(window.location.search).get("id");
            window.location.href = `fullscreen.html?id=${vehicleId}`;
        });

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);



        async function loadFeatures(vehicleId) {
    const featureCategories = [
        "mechanical",
        "safety",
        "exterior",
        "interior",
        "entertainment",
        "additional"
    ];

    try {
        // Fetch the vehicle document from Firestore
        const inventoryRef = doc(db, "inventory", vehicleId);
        const soldRef = doc(db, "sold", vehicleId);

        const [inventoryDoc, soldDoc] = await Promise.all([
            getDoc(inventoryRef),
            getDoc(soldRef)
        ]);

        // Determine which document exists
        const vehicleDoc = inventoryDoc.exists() ? inventoryDoc : soldDoc.exists() ? soldDoc : null;

        if (!vehicleDoc.exists()) {
            console.error("Vehicle not found!");
            return;
        }

        const vehicleData = vehicleDoc.data();

        // Check if features exist in the document
        if (!vehicleData.features) {
            console.error("No features found for this vehicle.");
            return;
        }

        // Loop through each category and populate the accordion
        for (const category of featureCategories) {
            const specsElement = document.getElementById(`${category}-specs`);
            const features = vehicleData.features[capitalizeFirstLetter(category)] || {};

            // Filter out items with value "N/A"
            const validFeatures = Object.entries(features).filter(([key, value]) => value !== "N/A");

            // Populate the accordion body with valid features and always include the CTA button
            specsElement.innerHTML = `
                <ul>
                    ${validFeatures
                        .map(([key, value]) => `<li><strong>${key}:</strong> ${value}</li>`)
                        .join("")}
                </ul>
                <span><button class="cta-button" onclick="redirectToContact()">Request More Info</button></span>
            `;
        }
    } catch (error) {
        console.error("Error loading features:", error);
    }
}

// Utility function to capitalize the first letter of a string
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}






// Simulate an API call (replace with real API logic)
async function fetchFeatureData(vehicleId, category) {
    // Replace with actual database logic
    return category === "mechanical" ? ["Engine: V6", "Transmission: Automatic"] : [];
}

// Load features on page load
document.addEventListener("DOMContentLoaded", () => {
    const vehicleId = new URLSearchParams(window.location.search).get("id");
    if (vehicleId) loadFeatures(vehicleId);
});

async function fetchVehicleDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const vehicleId = urlParams.get('id'); // Get the vehicle ID from the URL

    if (!vehicleId) {
        console.error("No vehicle ID provided in the URL.");
        return;
    }

    const inventoryRef = doc(db, "inventory", vehicleId);
    const soldRef = doc(db, "sold", vehicleId);

    try {
        // Try fetching from the "inventory" collection first
        let vehicleSnapshot = await getDoc(inventoryRef);
        let status = "Available"; 

        if (!vehicleSnapshot.exists()) {
            // If not found in "inventory", check "sold" collection
            vehicleSnapshot = await getDoc(soldRef);
            status = "Sold";
        }

        if (!vehicleSnapshot.exists()) {
            console.error("Vehicle not found in any database.");
            return;
        }

        const vehicleData = vehicleSnapshot.data();
        displayVehicleDetails(vehicleData, status);

    } catch (error) {
        console.error("Error fetching vehicle details:", error);
    }
}



        async function loadVehicleDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const vehicleId = urlParams.get("id");

            if (vehicleId) {
                const inventoryRef = doc(db, "inventory", vehicleId);
                const soldRef = doc(db, "sold", vehicleId);

                // Fetch both documents
                const [inventoryDoc, soldDoc] = await Promise.all([
                    getDoc(inventoryRef),
                    getDoc(soldRef)
                ]);

                // Determine which one exists
                const vehicleDoc = inventoryDoc.exists() ? inventoryDoc : soldDoc.exists() ? soldDoc : null;

                if (vehicleDoc.exists()) {
                    const data = vehicleDoc.data();

                    // Update main vehicle details
                    document.getElementById("vehicle-title").textContent = `${data.year} ${data.make} ${data.model}`;
                    document.getElementById("vehicle-trim").textContent = data.trim ? `| ${data.trim}` : '';
                    document.getElementById("main-carousel-image").src = data.mainPictureUrl;
                    document.getElementById("vehicle-price").textContent = `$${parseFloat(data.price).toLocaleString('en-US')}`;
                    document.getElementById("vehicle-vin").textContent = `VIN: ${(data.vin || "N/A").toUpperCase()}`;
                    document.getElementById("vehicle-stock").textContent = `Stock #: ${data.stock || "N/A"}`;
                    document.getElementById("vehicle-description").textContent = data.description || "No description available.";
                    
                    // Set up the description with "Read More" functionality
                    const descriptionElement = document.getElementById("vehicle-description");
                    const fullDescription = data.description || "No description available.";
                    const previewLength = 200;

                    if (fullDescription.length > previewLength) {
                        const previewText = fullDescription.substring(0, previewLength) + "...";
                        descriptionElement.innerHTML = `
                            <p id="description-preview">${previewText}</p>
                            <p id="description-full" style="display: none;">${fullDescription}</p>
                            <a href="#" id="toggle-description-link">See More</a>
                        `;

                        const toggleLink = document.getElementById("toggle-description-link");
                        const preview = document.getElementById("description-preview");
                        const fullText = document.getElementById("description-full");

                        toggleLink.addEventListener("click", (event) => {
                            event.preventDefault();
                            if (toggleLink.textContent === "See More") {
                                preview.style.display = "none";
                                fullText.style.display = "inline";
                                toggleLink.textContent = "See Less";
                            } else {
                                preview.style.display = "inline";
                                fullText.style.display = "none";
                                toggleLink.textContent = "See More";
                            }
                        });
                    } else {
                        descriptionElement.textContent = fullDescription;
                    }

                    // Update key details in grid layout
                    document.getElementById("vehicle-details-list").innerHTML = `
                        <li><span class="label">Mileage</span><span class="value">${parseInt(data.mileage).toLocaleString('en-US')} km</span></li>
                        <li><span class="label">Transmission</span><span class="value">${data.transmission}</span></li>
                        <li><span class="label">Body Style</span><span class="value">${data.bodyStyle || "N/A"}</span></li>
                        <li><span class="label">Color</span><span class="value">${data.color}</span></li>
                        <li><span class="label">Doors</span><span class="value">${data.doors || "N/A"}</span></li>
                        <li><span class="label">Seats</span><span class="value">${data.seats || "N/A"}</span></li>                                                
                        <li><span class="label">Engine Type</span><span class="value">${data.engine || "N/A"}</span></li>
                        <li><span class="label">Fuel Type</span><span class="value">${data.fuelType || "N/A"}</span></li>
                        <li><span class="label">Drivetrain Type</span><span class="value">${data.driveTrain || "N/A"}</span></li>

                        
                    `;

                    // Update the sidebar price
                    document.getElementById("sidebar-price").textContent = `$${parseFloat(data.price).toLocaleString('en-US')}`;

                    // Populate thumbnail images
                    const thumbnailStrip = document.querySelector(".thumbnail-strip");

                    const mainThumbnail = document.createElement("img");
                    mainThumbnail.src = data.mainPictureUrl;
                    mainThumbnail.alt = `${data.make} ${data.model}`;
                    mainThumbnail.classList.add("active-thumbnail");
                    thumbnailStrip.appendChild(mainThumbnail);

                    data.secondaryPicturesUrls.forEach(url => {
                        const img = document.createElement("img");
                        img.src = url;
                        img.alt = `${data.make} ${data.model}`;
                        thumbnailStrip.appendChild(img);
                    });

                    setupCarousel();
                    // Add click event to redirect to fullscreen page
                    document.getElementById("main-carousel-image").addEventListener("click", () => {
                    window.location.href = `fullscreen.html?id=${vehicleId}`;
                    });
                } else {
                    alert("Vehicle not found!");
                }
            } else {
                alert("No vehicle selected!");
            }
        }

        function setupCarousel() {
    let currentIndex = 0;
    const mainImage = document.getElementById("main-carousel-image");
    const thumbnails = document.querySelectorAll(".thumbnail-strip img");
    const nextButton = document.querySelector(".carousel-button.next");
    const prevButton = document.querySelector(".carousel-button.prev");
    const thumbnailStrip = document.querySelector(".thumbnail-strip");

    const images = Array.from(thumbnails).map(img => img.src);

    // Dynamically adjust thumbnail size for smaller screens
    function adjustThumbnailSize() {
        if (window.innerWidth <= 768) {
            thumbnails.forEach(thumbnail => {
                thumbnail.style.width = "50px";
                thumbnail.style.height = "50px";
            });
        } else {
            thumbnails.forEach(thumbnail => {
                thumbnail.style.width = "80px";
                thumbnail.style.height = "80px";
            });
        }
    }

    // Initial size adjustment
    adjustThumbnailSize();

    // Re-adjust size on window resize
    window.addEventListener("resize", adjustThumbnailSize);

    function updateMainImage() {
        if (images.length > 0) {
            mainImage.src = images[currentIndex];
            thumbnails.forEach((thumbnail, index) => {
                thumbnail.classList.toggle("active-thumbnail", index === currentIndex);
            });
            scrollToActiveThumbnail();
        }
    }

    function scrollToActiveThumbnail() {
        const activeThumbnail = thumbnails[currentIndex];
        if (activeThumbnail) {
            activeThumbnail.scrollIntoView({
                behavior: "smooth",
                block: "nearest",
                inline: "center",
            });
        }
    }

    nextButton.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % images.length;
        updateMainImage();
    });

    prevButton.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateMainImage();
    });

    thumbnails.forEach((thumbnail, index) => {
        thumbnail.addEventListener("click", () => {
            currentIndex = index;
            updateMainImage();
        });
    });

    updateMainImage();
}


        loadVehicleDetails();
    </script>
    <script>
        function redirectToFinance() {
            const vehicleTitle = document.getElementById("vehicle-title").textContent;
            const vehiclePrice = document.getElementById("vehicle-price").textContent;
            const formattedVehicle = `${vehicleTitle} - ${vehiclePrice}`;
            const urlParams = new URLSearchParams();
            urlParams.append("vehicle", formattedVehicle);

            window.location.href = `finance-application.html?${urlParams.toString()}`;
        }

        function redirectToTestDrive() {
            const vehicleTitle = document.getElementById("vehicle-title").textContent;
            const vehiclePrice = document.getElementById("vehicle-price").textContent;
            const formattedVehicle = `${vehicleTitle} - ${vehiclePrice}`;
            const urlParams = new URLSearchParams();
            urlParams.append("vehicle", formattedVehicle);

            window.location.href = `test-drive.html?${urlParams.toString()}`;
        }

        function redirectToContact() {
            const vehicleTitle = document.getElementById("vehicle-title").textContent;
            const vehiclePrice = document.getElementById("vehicle-price").textContent;
            const formattedVehicle = `${vehicleTitle} - ${vehiclePrice}`;
            const message = `Hello, I am interested in more information about the ${formattedVehicle}`;
            const urlParams = new URLSearchParams();
            urlParams.append("message", message);

            window.location.href = `index.html?${urlParams.toString()}#contact-form`;
        }
    </script>
    <!-- Navbar Toggle for Mobile -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuIcon = document.getElementById('menu-icon');
        const navbar = document.querySelector('.navbar');

        if (menuIcon && navbar) {
            menuIcon.addEventListener('click', () => {
                navbar.classList.toggle('active');
            });
        }
    });

    document.addEventListener("DOMContentLoaded", () => {
    const body = document.body;
    body.style.display = "none";

    window.onload = () => {
        body.style.display = "block";
    };
});



function toggleAccordion(header) {
    const body = header.nextElementSibling;
    const isActive = body.classList.contains("active");
    const icon = header.querySelector(".accordion-icon");

    if (!isActive) {
        body.classList.add("active");
        icon.textContent = "▲";
    }
    if (isActive){
        body.classList.remove("active");
        icon.textContent = "▼";

    }
}
</script>

</body>

</html>

